<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychedelic Shader Viewer</title>
    <style>
        html, body { height: 100%; margin: 0; background: #0a0a0a; color: #e6e6e6; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; }
        .container { display: grid; grid-template-columns: 280px 1fr; grid-template-rows: auto 1fr; height: 100%; }
        header { grid-column: 1 / -1; padding: 10px 14px; background: #111; border-bottom: 1px solid #222; display: flex; gap: 12px; align-items: center; }
        header h1 { font-size: 16px; margin: 0; font-weight: 600; letter-spacing: .3px; color: #fafafa; }
        #sidebar { padding: 12px; border-right: 1px solid #222; background: #0f0f0f; overflow: auto; }
        #sidebar h2 { font-size: 12px; font-weight: 700; color: #c9c9c9; margin: 14px 0 6px; text-transform: uppercase; letter-spacing: .08em; }
        #sidebar label { display: block; font-size: 12px; color: #c8c8c8; margin: 8px 0 4px; }
        #sidebar input[type="range"] { width: 100%; }
        #sidebar input[type="number"] { width: 100%; background: #0c0c0c; color: #eee; border: 1px solid #2a2a2a; padding: 6px 8px; border-radius: 6px; }
        #drop { border: 1px dashed #2a2a2a; padding: 10px; border-radius: 8px; text-align: center; color: #aaa; cursor: pointer; }
        #drop:hover { background: #111; }
        #glwrap { position: relative; height: 100%; }
        canvas { width: 100%; height: 100%; display: block; }
        .row { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }
        .small { font-size: 11px; color: #9a9a9a; }
        .btn { padding: 6px 10px; background: #1a1a1a; color: #f0f0f0; border: 1px solid #2a2a2a; border-radius: 6px; cursor: pointer; }
        .btn:hover { background: #222; }
        .hidden { display: none; }
        .margin-top { margin-top: 8px; }
        a { color: #8fd3ff; text-decoration: none; }
        .status { position: absolute; left: 12px; bottom: 12px; background: rgba(0,0,0,0.6); border: 1px solid #333; color: #eee; padding: 6px 10px; border-radius: 6px; pointer-events: none; }
    </style>
    <script defer src="./main.js"></script>
    <link rel="preload" href="./shader.vert" as="fetch" crossorigin>
    <link rel="preload" href="./shader.frag" as="fetch" crossorigin>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop stop-color='%23ff00e5'/%3E%3Cstop offset='1' stop-color='%2300ffd5'/%3E%3C/linearGradient%3E%3Crect width='64' height='64' fill='url(%23g)'/%3E%3Ccircle cx='32' cy='32' r='18' fill='none' stroke='%23fff' stroke-width='6'/%3E%3C/svg%3E">
    <meta name="color-scheme" content="dark">
    <meta name="description" content="Local ShaderToy-style viewer with kaleidoscopic psychedelic shader and custom image upload.">
</head>
<body>
    <div class="container">
        <header>
            <h1>Psychedelic Shader Viewer</h1>
            <div class="small">Local ShaderToy-style preview with custom texture</div>
            <button id="playPause" type="button" class="btn">Pause</button>
            <label for="bpm" class="small">BPM</label>
            <input id="bpm" type="number" min="20" max="300" step="0.1" value="120">
        </header>
        <aside id="sidebar">
            <h2>Texture</h2>
            <label id="drop" for="file">Drop an image here or click to choose</label>
            <input id="file" type="file" accept="image/*" class="hidden">
            <div class="row margin-top">
                <button id="clearTex" type="button" class="btn">Clear texture</button>
                <span class="small" id="texInfo">No texture</span>
            </div>

            <h2>Video</h2>
            <div class="row">
                <button id="loadVideoBtn" type="button" class="btn">Load video</button>
                <input id="videoFile" type="file" accept="video/*" class="hidden">
            </div>
            <div class="row margin-top">
                <button id="useWebcam" type="button" class="btn">Use webcam</button>
                <span class="small" id="videoInfo">No video</span>
            </div>
            <div class="row margin-top">
                <label class="small" for="fitMode">Fit</label>
                <select id="fitMode">
                    <option value="cover" selected>Cover</option>
                    <option value="contain">Contain</option>
                    <option value="stretch">Stretch</option>
                </select>
            </div>
            <div class="row margin-top">
                <button id="videoPlayPause" type="button" class="btn">Play</button>
                <label class="small"><input id="videoMuted" type="checkbox" checked> Muted</label>
                <label class="small"><input id="videoLoop" type="checkbox" checked> Loop</label>
            </div>
            <input id="videoSeek" type="range" min="0" max="1000" value="0">

            <h2>Mandala</h2>
            <label><input id="enableKaleido" type="checkbox" checked> Enable kaleidoscope</label>
            <label for="segments">Segments <span class="small" id="segmentsLabel">8</span></label>
            <input id="segments" type="range" min="0" max="24" value="8">

            <label><input id="enableTile" type="checkbox"> MirrorGrid tiling</label>
            <label for="tileX">Tile X</label>
            <input id="tileX" type="range" min="1" max="8" step="1" value="2">
            <label for="tileY">Tile Y</label>
            <input id="tileY" type="range" min="1" max="8" step="1" value="2">
            <label><input id="tileMirror" type="checkbox" checked> Tile mirror</label>

            <label for="rotate">Rotate</label>
            <input id="rotate" type="range" min="0" max="6.283" step="0.001" value="0.0">

            <label for="zoom">Zoom</label>
            <input id="zoom" type="range" min="0.25" max="3" step="0.01" value="1">
            <label for="kInner">Mask inner radius</label>
            <input id="kInner" type="range" min="0" max="1.2" step="0.001" value="0.15">
            <label for="kOuter">Mask outer radius</label>
            <input id="kOuter" type="range" min="0" max="1.5" step="0.001" value="0.85">

            <h2>Warping</h2>
            <label><input id="enableWarp" type="checkbox" checked> Enable warping</label>
            <label for="warp">Warp strength</label>
            <input id="warp" type="range" min="0" max="1" step="0.001" value="0.3">
            <label for="flow">Flow speed</label>
            <input id="flow" type="range" min="0" max="3" step="0.01" value="1.0">

            <h2>Color</h2>
            <label><input id="enableColor" type="checkbox" checked> Enable color cycling</label>
            <label for="colorSpeed">Color speed</label>
            <input id="colorSpeed" type="range" min="0" max="3" step="0.01" value="0.8">
            <label for="texMix">Texture mix</label>
            <input id="texMix" type="range" min="0" max="1" step="0.01" value="0.7">
            <label><input id="enableChromaFlow" type="checkbox" checked> Flow-based chromatic aberration</label>
            <label for="chromaAmt">Chroma amount</label>
            <input id="chromaAmt" type="range" min="0" max="4" step="0.01" value="1.2">

            <h2>Bloom</h2>
            <label><input id="enableBloom" type="checkbox" checked> Enable bloom</label>
            <label for="bloomThreshold">Threshold</label>
            <input id="bloomThreshold" type="range" min="0" max="1" step="0.01" value="0.6">
            <label for="bloomIntensity">Intensity</label>
            <input id="bloomIntensity" type="range" min="0" max="3" step="0.01" value="0.8">
            <label for="bloomRadius">Radius</label>
            <input id="bloomRadius" type="range" min="0.5" max="3" step="0.05" value="1.2">

            <h2>Utils</h2>
            <button id="saveFrame" type="button" class="btn">Save frame (PNG)</button>
            <div class="small margin-top">Mouse moves the focus. Resize window is supported.</div>
            <h2>Presets</h2>
            <div class="row">
                <label for="preset" class="small">Preset</label>
                <select id="preset">
                    <option value="default">Default</option>
                    <option value="tunnel">Mandala Tunnel</option>
                    <option value="flow">Liquid Flow</option>
                    <option value="softbloom">Soft Bloom</option>
                </select>
                <button id="applyPreset" type="button" class="btn">Apply</button>
            </div>
            <div class="row margin-top">
                <input id="presetName" type="text" placeholder="Preset name" class="small">
                <button id="savePreset" type="button" class="btn">Save</button>
            </div>
            <div class="row margin-top">
                <button id="updatePreset" type="button" class="btn">Update</button>
                <button id="deletePreset" type="button" class="btn">Delete</button>
                <button id="setStartupPreset" type="button" class="btn">Set as startup</button>
            </div>
            <div class="row margin-top">
                <button id="exportPreset" type="button" class="btn">Export</button>
                <button id="importPreset" type="button" class="btn">Import</button>
                <button id="sharePreset" type="button" class="btn">Share URL</button>
            </div>
            <input id="importFile" type="file" accept="application/json" class="hidden">
            <h2>Flow Field</h2>
            <label><input id="enableFlowAdvect" type="checkbox" checked> Enable flow advection</label>
            <label for="flowMix">Flow mix (edgesâ†”curl)</label>
            <input id="flowMix" type="range" min="0" max="1" step="0.01" value="0.6">
            <label for="advectStrength">Advect strength (px/frame)</label>
            <input id="advectStrength" type="range" min="0" max="6" step="0.01" value="0.5">
            <label for="curlScale">Curl scale</label>
            <input id="curlScale" type="range" min="0.5" max="8" step="0.1" value="2.5">
            <label for="curlSpeed">Curl speed</label>
            <input id="curlSpeed" type="range" min="0" max="3" step="0.01" value="1.0">
            <label><input id="enableOpticalFlow" type="checkbox"> Enable optical flow</label>
            <label for="optFlowScale">Optical flow scale</label>
            <input id="optFlowScale" type="range" min="0" max="20" step="0.01" value="6.0">
            <label for="optFlowRadius">Optical flow window</label>
            <input id="optFlowRadius" type="range" min="1" max="3" step="1" value="2">
            <label><input id="enablePyramidalFlow" type="checkbox" checked> Pyramidal flow (half-res)</label>
            <label for="pyrLargeWeight">Pyramid large weight</label>
            <input id="pyrLargeWeight" type="range" min="0" max="1" step="0.01" value="0.5">
            <label for="flowSmoothing">Flow temporal smoothing</label>
            <input id="flowSmoothing" type="range" min="0" max="0.99" step="0.01" value="0.6">
            <label><input id="enableAutoGain" type="checkbox" checked> Auto-gain advection</label>

            <h2>Feedback</h2>
            <label><input id="enableFeedback" type="checkbox" checked> Enable feedback tunnel</label>
            <label for="decay">Decay</label>
            <input id="decay" type="range" min="0.80" max="0.999" step="0.001" value="0.965">
            <label for="zoomRate">Zoom rate</label>
            <input id="zoomRate" type="range" min="0.0" max="0.02" step="0.0005" value="0.004">
            <label for="rotateRate">Rotate rate</label>
            <input id="rotateRate" type="range" min="-0.02" max="0.02" step="0.0005" value="0.002">
            <label><input id="enablePolarFeedback" type="checkbox" checked> Spiral Tunnel (log-polar)</label>
            <label for="polarScale">Polar scale</label>
            <input id="polarScale" type="range" min="0.5" max="4" step="0.01" value="1.2">
            <label for="polarTwist">Polar twist</label>
            <input id="polarTwist" type="range" min="-2" max="2" step="0.001" value="0.3">
            <label for="echoTaps">Orbital Echo taps</label>
            <input id="echoTaps" type="range" min="0" max="3" step="1" value="2">
            <label for="echoMix">Orbital Echo mix</label>
            <input id="echoMix" type="range" min="0" max="1" step="0.01" value="0.35">
            <label for="echoAngle">Orbital Echo angle</label>
            <input id="echoAngle" type="range" min="0" max="1.5707" step="0.001" value="0.25">
            <div class="row margin-top">
                <button id="resetFeedback" type="button" class="btn">Reset feedback</button>
                <span class="small">Clears trail</span>
            </div>
        </aside>
        <main id="glwrap">
            <canvas id="glcanvas"></canvas>
            <video id="video" class="hidden" playsinline muted loop></video>
            <div id="status" class="status hidden"></div>
        </main>
    </div>
</body>
</html>

